<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯’å‡é€†è¢­è®¡åˆ’</title>
  <style>
    * {box-sizing: border-box; margin: 0; padding: 0;}
    body {font-family: "Microsoft YaHei", sans-serif; background: #f7f8fa; padding: 15px;}
    .container {max-width: 100%; background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);}
    h1 {text-align: center; font-size: 18px; color: #333; margin-bottom: 15px;}
    .top-bar {display: flex; flex-wrap: wrap; justify-content: space-between; background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 13px; color: #2e7d32;}
    .section {margin-bottom: 20px;}
    .section-title {font-size: 15px; font-weight: bold; color: #333; border-bottom: 1px solid #4caf50; padding-bottom: 8px; margin-bottom: 10px;}
    .task-item {display: flex; align-items: flex-start; margin: 8px 0; font-size: 13px;}
    .task-item input {margin-right: 8px; margin-top: 2px;}
    .task-text {flex: 1;}
    .reward {color: #2e7d32; font-size: 12px; margin-left: 5px;}
    .penalty {color: #d32f2f; font-size: 12px; margin-left: 5px;}
    .btn {width: 100%; padding: 12px; border: none; border-radius: 8px; margin: 10px 0; font-size: 16px; cursor: pointer;}
    .btn-orange {background: #ff9800; color: #fff;}
    .btn-purple {background: #9c27b0; color: #fff;}
    .btn-green {background: #4caf50; color: #fff;}
    .btn-red {background: #f44336; color: #fff;}
    .record {background: #f9f9f9; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 12px; max-height: 150px; overflow-y: auto;}
    .pool-remain {background: #fff3e0; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 12px; max-height: 150px; overflow-y: auto; color: #ef6c00;}
    .lottery-modal {position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 999;}
    .lottery-content {background: #fff; padding: 20px; border-radius: 12px; text-align: center; width: 90%; max-width: 320px;}
    .lottery-wheel {width: 200px; height: 200px; border-radius: 50%; margin: 0 auto 20px; position: relative; overflow: hidden; border: 8px solid #4caf50;}
    .wheel-item {position: absolute; width: 50%; height: 50%; transform-origin: bottom right; display: flex; justify-content: center; align-items: flex-start; padding-top: 15px; font-size: 10px; font-weight: bold; color: #fff;}
    .lottery-pointer {width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 30px solid #ff9800; margin: 0 auto; position: relative; top: -10px; z-index: 10;}
    .lottery-result {font-size: 16px; font-weight: bold; margin: 20px 0; color: #e91e63;}
  </style>
</head>
<body>
<div class="container">
  <h1>å¯’å‡é€†è¢­è®¡åˆ’ ğŸ¯</h1>
  <div class="top-bar">
    <span>æŠ½å¥–æ¬¡æ•°ï¼š<span id="c">0</span> æ¬¡</span>
    <span>ä»Šæ—¥ç½šæ¬¾ï¼šÂ¥<span id="tf">0</span></span>
    <span>ä»Šæ—¥è·å¾—ï¼šÂ¥<span id="tg">0</span></span>
    <span>ç´¯è®¡ç½šæ¬¾ï¼šÂ¥<span id="tof">0</span></span>
    <span>ç´¯è®¡è·å¾—ï¼šÂ¥<span id="tog">0</span></span>
  </div>

  <div class="section">
    <div class="section-title">æ¯æ—¥å¿…åšä»»åŠ¡</div>
    <div class="task-item"><input type="checkbox" id="t1" onchange="toggleTask('t1',0,10)"><label for="t1" class="task-text">6:30èµ·åºŠï¼Œå è¢«å­ï¼ˆ2å¤©ä¸€æ¬¡ï¼‰</label><span class="penalty">ç½šæ¬¾ï¼šÂ¥10</span></div>
    <div class="task-item"><input type="checkbox" id="t2" onchange="toggleTask('t2',0,20)"><label for="t2" class="task-text">ä¿æŒæˆ¿é—´å¹²å‡€æ•´æ´ï¼ˆ2å¤©ä¸€æ¬¡ï¼‰</label><span class="penalty">ç½šæ¬¾ï¼šÂ¥20</span></div>
    <div class="task-item"><input type="checkbox" id="t3" onchange="toggleTask('t3',1,50)"><label for="t3" class="task-text">å®Œæˆ3ä¸ªè§†é¢‘è¿åŠ¨</label><span class="reward">å¥–åŠ±ï¼š1æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥50</span></div>
    <div class="task-item"><input type="checkbox" id="t4" onchange="toggleTask('t4',1,20)"><label for="t4" class="task-text">8:30å‰åˆ°å›¾ä¹¦é¦†</label><span class="reward">å¥–åŠ±ï¼š1æ¬¡</span></div>
    <div class="task-item"><input type="checkbox" id="t5" onchange="toggleTask('t5',3,50)"><label for="t5" class="task-text">ä¸Šä¸€èŠ‚èµµç¤¼æ˜¾æ•°å­¦ï¼ˆ3hï¼‰</label><span class="reward">å¥–åŠ±ï¼š3æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥50</span></div>
    <div class="task-item"><input type="checkbox" id="t6" onchange="toggleTask('t6',1,50)"><label for="t6" class="task-text">æ•°å­¦åˆ·ä¸€é¢é¢˜</label><span class="reward">å¥–åŠ±ï¼š1æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥50</span></div>
    <div class="task-item"><input type="checkbox" id="t7" onchange="toggleTask('t7',2,30)"><label for="t7" class="task-text">æ—¥è¯­èƒŒ10è¯+2å¥é»˜å†™</label><span class="reward">å¥–åŠ±ï¼š2æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥30</span></div>
    <div class="task-item"><input type="checkbox" id="t8" onchange="toggleTask('t8',0,10)"><label for="t8" class="task-text">è¯­æ–‡ç§¯ç´¯å¥½å¥ï¼ˆ3å¤©ä¸€æ¬¡ï¼‰</label><span class="penalty">ç½šæ¬¾ï¼šÂ¥10</span></div>
    <div class="task-item"><input type="checkbox" id="t9" onchange="toggleTask('t9',0,10)"><label for="t9" class="task-text">åŒ–å­¦ä¸Šä¸€èŠ‚</label><span class="penalty">ç½šæ¬¾ï¼šÂ¥10</span></div>
    <div class="task-item"><input type="checkbox" id="t10" onchange="toggleTask('t10',0,10)"><label for="t10" class="task-text">ç»ƒå­—åŠé¡µï¼ˆ2å¤©ä¸€æ¬¡ï¼‰</label><span class="penalty">ç½šæ¬¾ï¼šÂ¥10</span></div>
    <div class="task-item"><input type="checkbox" id="t11" onchange="toggleTask('t11',1,20)"><label for="t11" class="task-text">ä¸Š40åˆ†é’Ÿè¯­æ–‡è¯¾</label><span class="reward">å¥–åŠ±ï¼š1æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥20</span></div>
    <div class="task-item"><input type="checkbox" id="t12" onchange="toggleTask('t12',2,50)"><label for="t12" class="task-text">ä¸¤å¤©ä¸Š3èŠ‚ç‰©ç†è¯¾</label><span class="reward">å¥–åŠ±ï¼š2æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥50</span></div>
    <div class="task-item"><input type="checkbox" id="t13" onchange="toggleTask('t13',2,50)"><label for="t13" class="task-text">å­¦ä¹ å‰ä¸åˆ·å¨±ä¹è½¯ä»¶</label><span class="reward">å¥–åŠ±ï¼š2æ¬¡</span><span class="penalty">ç½šæ¬¾ï¼šÂ¥50</span></div>
  </div>

  <button class="btn btn-orange" onclick="startLottery()" disabled id="lotteryBtn">ç‚¹å‡»æŠ½å¥–</button>
  <button class="btn btn-green" onclick="resetPool()">é‡ç½®å¥–æ± </button>
  <button class="btn btn-red" onclick="resetToday()">é‡ç½®ä»Šæ—¥æ•°æ®</button>

  <div class="pool-remain" id="poolRemain">å¥–æ± å‰©ä½™ï¼š</div>
  <div class="record" id="record">æŠ½å¥–è®°å½•ï¼š</div>

  <div class="lottery-modal" id="lotteryModal">
    <div class="lottery-content">
      <div class="lottery-pointer"></div>
      <div class="lottery-wheel" id="lotteryWheel"></div>
      <div class="lottery-result" id="lotteryResult"></div>
      <button class="btn btn-purple" onclick="closeModal()">ç¡®å®š</button>
    </div>
  </div>
</div>

<script>
let c = 0,tf = 0,tg = 0,tof = 0,tog = 0;
let tasks = {},record = [],currentPool = [];

const originalPool = [
  {name:"è°¢è°¢æƒ é¡¾",value:0},{name:"è°¢è°¢æƒ é¡¾",value:0},{name:"è°¢è°¢æƒ é¡¾",value:0},{name:"è°¢è°¢æƒ é¡¾",value:0},{name:"è°¢è°¢æƒ é¡¾",value:0},
  {name:"5å…ƒ",value:5},{name:"5å…ƒ",value:5},
  {name:"10å…ƒ",value:10},{name:"10å…ƒ",value:10},
  {name:"15å…ƒ",value:15},{name:"20å…ƒ",value:20},
  {name:"å…ç½š10å…ƒÃ—3",value:10},
  {name:"å§‘ç©ç¢ç‰‡Ã—2",value:0},{name:"ç”µå½±ç¢ç‰‡Ã—1",value:0},
  {name:"ä¸€åªç¾½æ¯›çƒÃ—2",value:0},{name:"å¯å€Ÿ100Ã—1",value:100},
  {name:"æœèŒ¶Ã—1",value:0},{name:"å‡ºå»ç©ç¢ç‰‡Ã—1",value:0}
];

function init(){loadData();if(currentPool.length===0)resetPool();renderUI();initLotteryWheel();}
function loadData(){const d=JSON.parse(localStorage.getItem('nixiPlanData')||'{}');c=d.c||0;tf=d.tf||0;tg=d.tg||0;tof=d.tof||0;tog=d.tog||0;tasks=d.tasks||{};record=d.record||[];currentPool=d.currentPool||[];}
function saveData(){localStorage.setItem('nixiPlanData',JSON.stringify({c,tf,tg,tof,tog,tasks,record,currentPool}));}

function renderUI(){
  document.getElementById('c').innerText=c;
  document.getElementById('tf').innerText=tf;
  document.getElementById('tg').innerText=tg;
  document.getElementById('tof').innerText=tof;
  document.getElementById('tog').innerText=tog;
  Object.keys(tasks).forEach(k=>{const e=document.getElementById(k);if(e)e.checked=tasks[k];});
  const b=document.getElementById('lotteryBtn');
  b.disabled=c<=0||currentPool.length===0;
  b.innerText=`æŠ½å¥–ï¼ˆå‰©${c}æ¬¡ï½œæ± ${currentPool.length}ä»¶ï¼‰`;
  document.getElementById('record').innerText=`è®°å½•ï¼š\n${record.join('\n')}`;
  
  // æ˜¾ç¤ºå‰©ä½™å¥–å“
  const rem=document.getElementById('poolRemain');
  rem.innerText=`å¥–æ± å‰©ä½™ï¼ˆå…±${currentPool.length}ä»¶ï¼‰ï¼š\n`+currentPool.map(i=>i.name).join(' | ');
}

function toggleTask(tid,rew,pen){const ok=!tasks[tid];tasks[tid]=ok;ok?(c+=rew):(tf+=pen,tof+=pen);saveData();renderUI();}
function resetPool(){currentPool=[...originalPool];saveData();renderUI();initLotteryWheel();alert('å¥–æ± å·²é‡ç½®');}
function resetToday(){if(confirm('é‡ç½®ä»Šæ—¥ï¼Ÿç´¯è®¡ä¸å˜')){tf=0;tg=0;saveData();renderUI();alert('ä»Šæ—¥å·²é‡ç½®');}}

function startLottery(){
  if(c<=0||currentPool.length===0)return;c--;
  const m=document.getElementById('lotteryModal');
  const w=document.getElementById('lotteryWheel');
  const r=document.getElementById('lotteryResult');
  m.style.display='flex';
  const i=Math.floor(Math.random()*currentPool.length);
  const g=currentPool.splice(i,1)[0];
  w.style.transition='transform 3s';
  w.style.transform=`rotate(${360*5+(360/originalPool.length)*i}deg)`;
  setTimeout(()=>{
    r.innerText=`æŠ½ä¸­ï¼š${g.name}`;
    if(g.value>0){tf=Math.max(tf-g.value,0);tg+=g.value;tog+=g.value;}
    record.unshift(`[${new Date().toLocaleTimeString()}] ${g.name}`);
    record=record.slice(0,10);saveData();renderUI();initLotteryWheel();
  },3000);
}

function closeModal(){document.getElementById('lotteryModal').style.display='none';const w=document.getElementById('lotteryWheel');w.style.transition='none';w.style.transform='rotate(0deg)';}
function initLotteryWheel(){const w=document.getElementById('lotteryWheel');w.innerHTML='';const a=360/originalPool.length;originalPool.forEach((g,i)=>{const d=document.createElement('div');d.className='wheel-item';d.style.transform=`rotate(${i*a}deg) skewY(${a-90}deg)`;d.style.background=i%2?'#2196f3':'#4caf50';d.innerText=g.name;w.appendChild(d);});}

window.onload=init;
</script>
</body>
</html>
